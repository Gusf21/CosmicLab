import"./style-BD-upOib.js";import{P as B,S as G,C as R,W as F,B as U,b as j,c as $,d as V,A as W,O as _,V as q,e as H,T,M as J,f as Q}from"./OrbitControls-CiCO4lTP.js";function K(t,e){return t+Math.floor(Math.random()*(e-t+1))}const S=149597870700,z=20;let w,y,M,x,I,v,N={},A=[],C=0,O=!0;function X(){Y()}function Y(){const t=window.innerWidth*.8/window.innerHeight;w=new B(60,t,.1,5e3),w.position.z=50,M=new G,M.background=new R(0),Z(),x=new F({antialias:!0}),x.setPixelRatio(window.devicePixelRatio),x.setSize(window.innerWidth*.8,window.innerHeight),x.setAnimationLoop(ie),document.body.appendChild(x.domElement),window.addEventListener("resize",te),ee(w)}function Z(){const t=new U,e=1e4,n=new Float32Array(e*3),o=new Float32Array(e),s=3e3,i=4e3;for(let a=0;a<e;a++){let m,u,r;m=Math.cbrt(Math.random()*(i**3-s**3)+s**3),u=Math.random()*Math.PI*2,r=Math.acos(2*Math.random()-1);let g=m*Math.sin(r)*Math.cos(u),c=m*Math.sin(r)*Math.sin(u),p=m*Math.cos(r);n[a*3]=g,n[a*3+1]=c,n[a*3+2]=p,o[a]=1.5+Math.random()}t.setAttribute("position",new j(n,3)),t.setAttribute("size",new j(o,1));const d=new $({uniforms:{time:{value:0}},vertexShader:`
        attribute float size;
        uniform float time;
        varying float vOpacity;
        
        void main() {
            vOpacity = 0.6 + 0.4 * sin(time + size * 10.0);
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            gl_PointSize = size * (300.0 / -mvPosition.z);
            gl_Position = projectionMatrix * mvPosition;
        }
    `,fragmentShader:`
        varying float vOpacity;
        void main() {
            gl_FragColor = vec4(1.0, 1.0, 1.0, vOpacity);
        }
    `,transparent:!0});I=new V(t,d),M.add(I),v=new W(1e3),M.add(v)}function ee(t){y=new _(t,x.domElement),y.target=new q(0,0,0),y.minDistance=.01,y.maxDistance=2e3,y.zoomSpeed=2,y.rotateSpeed=.3,y.enablePan=!1}function te(){const t=window.innerWidth*.8/window.innerHeight;w.aspect=t,w.updateProjectionMatrix(),x.setSize(window.innerWidth*.8,window.innerHeight)}function E(t,e,n,o,s,i){const d=["Volcanic","Oceanic","Tropical","Gas Giant","Venusian","Ice","Swamp"],a=d[Math.floor(Math.random()*d.length)],m=K(1,10),u=new H(.2*o,32,32);let r;i==null?r=new T().load(`../images/Textures/${a}/${a}-EQUIRECTANGULAR-${m}-1024x512.png`):(console.log(i),r=new T().load(`../images/Textures/Default/${i}.png`));const g=new J({map:r}),c=new Q(u,g);c.position.set(t*z,n*z,e*z),document.getElementById(s).querySelector("i").addEventListener("click",()=>{w.position.set(c.position.x,c.position.y,c.position.z>0?c.position.z+10:c.position.z-10),y.target=c.position}),N[s]=c,M.add(c)}function ie(){y.update(),I.material.uniforms.time.value=performance.now()*.002,ne()}function ne(){x.render(M,w)}function se(){setInterval(oe,1e3/24)}function D(t){A=A.concat(t)}window.ToggleSim=t=>{O=!O;let e=t.querySelector("i");O?(e.classList.remove("fa-pause"),e.classList.add("fa-play")):(e.classList.remove("fa-play"),e.classList.add("fa-pause"))};window.ToggleAxes=()=>{v.visible=!v.visible};function oe(){if(!O){let t=A[C];for(let e=0;e<t.length;e++)N[t[e].objectId].position.set(t[e].xPos*z/S,t[e].zPos*z/S,t[e].yPos*z/S);C++}C+1e3==A.length&&ae()}async function ae(){let t=await fetch(`https://cosmiclabapi.co.uk/api/Data/GetFrames?sessionId=${b("sessionId").replace(/['"]+/g,"").toUpperCase()}&timescale=3600&num=2000`);D(JSON.parse(await t.text()))}function b(t){let e=t+"=",o=decodeURIComponent(document.cookie).split(";");for(let s=0;s<o.length;s++){let i=o[s];for(;i.charAt(0)==" ";)i=i.substring(1);if(i.indexOf(e)==0)return i.substring(e.length,i.length)}return""}const l=[{id:1,name:"The Sun",type:"star",mass:1,radius:1,satellites:[{object:{id:2,name:"Mercury",type:"planet",mass:.055,radius:.382},orbit:{smAxis:.387098,eccentricity:.20563,inclination:7.005,longOfAscNode:48.331,argOfPeri:29.124}},{object:{id:3,name:"Venus",type:"planet",mass:.815,radius:.95},orbit:{smAxis:.723332,eccentricity:.006772,inclination:3.395,longOfAscNode:76.68,argOfPeri:54.884}},{object:{id:4,name:"Earth",type:"planet",mass:1,radius:1},orbit:{smAxis:1,eccentricity:.0167086,inclination:.005,longOfAscNode:174.873,argOfPeri:288.064}},{object:{id:5,name:"Mars",type:"planet",mass:.107,radius:.532},orbit:{smAxis:1.52368055,eccentricity:.0934,inclination:1.85,longOfAscNode:49.57854,argOfPeri:286.5}},{object:{id:6,name:"Jupiter",type:"planet",mass:317.8,radius:11},orbit:{smAxis:5.2038,eccentricity:.0489,inclination:1.303,longOfAscNode:100.464,argOfPeri:273.867}},{object:{id:7,name:"Saturn",type:"planet",mass:95.159,radius:9},orbit:{smAxis:9.5826,eccentricity:.0565,inclination:2.485,longOfAscNode:113.665,argOfPeri:339.392}},{object:{id:8,name:"Uranus",type:"planet",mass:14.536,radius:4},orbit:{smAxis:19.19126,eccentricity:.04717,inclination:.773,longOfAscNode:74.006,argOfPeri:96.998857}},{object:{id:9,name:"Neptune",type:"planet",mass:17.147,radius:3.85},orbit:{smAxis:30.07,eccentricity:.008678,inclination:1.77,longOfAscNode:131.783,argOfPeri:273.187}}]}];let P=[];const ce=667408e-16,f=149597870700,le=1.9884*10**30,re=5.972*10**24;var k;class h{constructor(e,n,o){this.x=e,this.y=n,this.z=o}rotate(e,n){let o=Math.cos(n),s=Math.sin(n),i=1-o,d=this.x*o+this.x*e.x*e.x*i+this.y*e.x*e.y*i-this.y*e.z*s+this.z*e.y*s+this.z*e.x*e.z*i,a=this.x*e.z*s+this.x*e.x*e.y*i+this.y*o+this.y*e.y*e.y*i+-1*this.z*e.x*s+this.z*e.y*e.z*i,m=-1*this.x*e.y*s+this.x*e.x*e.z*i+this.y*e.x*s+this.y*e.y*e.z*i+this.z*o+this.z*e.z*e.z*i;this.x=d,this.y=a,this.z=m}multiply(e){this.x*=e,this.y*=e,this.z*=e}}document.addEventListener("DOMContentLoaded",()=>{b("sessionId"),X(),de()});window.addEventListener("beforeunload",()=>{fetch(`https://cosmiclabapi.co.uk/api/Data/DeleteSimulation?sessionId=${b("sessionId").replace(/['"]+/g,"").toUpperCase()}`,{method:"POST",headers:{"Content-Type":"application/json"}})});function de(){const t=l.length;for(let e=0;e<t;e++){let n={CelestialObject:{id:l[e].id,name:l[e].name,type:l[e].type,mass:l[e].mass,radius:l[e].radius},telemetry:{position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0}}};const o=l[e].satellites.length;L(l[e]),E(n.telemetry.position.x/f,n.telemetry.position.y/f,n.telemetry.position.z/f,n.CelestialObject.radius*10,n.CelestialObject.id,n.CelestialObject.name),P.push(n);for(let s=0;s<o;s++){let i={CelestialObject:{id:l[e].satellites[s].object.id,name:l[e].satellites[s].object.name,type:l[e].satellites[s].object.type,mass:l[e].satellites[s].object.mass,radius:l[e].satellites[s].object.radius},telemetry:{position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0}}};pe(n,i,l[e].satellites[s].orbit),L(l[e].satellites[s].object),E(i.telemetry.position.x/f,i.telemetry.position.y/f,i.telemetry.position.z/f,i.CelestialObject.radius,i.CelestialObject.id,i.CelestialObject.name),P.push(i)}}ye()}function L(t){const e=document.getElementById("card-container"),o=document.getElementById("info-card-template").content.cloneNode(!0);o.querySelector("span").innerText=t.name,o.querySelector("div").id=t.id,e.appendChild(o)}function me(t,e,n){let o=e-t*e;return Math.sqrt(ce*n*(2/o-1/e))}function pe(t,e,n){const o=(n.smAxis-n.eccentricity*n.smAxis)*f,s=new h(o,0,0),i=new h(t.telemetry.position.x,t.telemetry.position.y,t.telemetry.position.z),d=n.longOfAscNode*Math.PI/180,a=n.inclination*Math.PI/180,m=n.argOfPeri*Math.PI/180,u=Math.cos(a),r=Math.sin(a),g=Math.cos(d),c=Math.sin(d);s.rotate(new h(0,0,1),d),s.rotate(new h(c,-1*g,0),a),s.rotate(new h(-1*r*g,-1*r*c,u),m),e.telemetry.position.x=i.x+s.x,e.telemetry.position.y=i.y+s.y,e.telemetry.position.z=i.z+s.z;let p=new h(0,1,0);p.rotate(new h(0,0,1),d),p.rotate(new h(-1*r*g,-1*r*c,u),m),p.multiply(me(n.eccentricity,n.smAxis*f,t.CelestialObject.mass*(t.CelestialObject.type=="planet"?re:le))),e.telemetry.velocity.x=p.x,e.telemetry.velocity.y=p.y,e.telemetry.velocity.z=p.z}async function ye(){let t={};t.Objects=P,t.SessionId=b("sessionId").replace(/['"]+/g,"").toUpperCase(),t.Timescale=3600;let e;ue(),await fetch("https://cosmiclabapi.co.uk/api/Data/StartSimulation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async()=>{e=await fetch(`https://cosmiclabapi.co.uk/api/Data/GetFrames?sessionId=${b("sessionId").replace(/['"]+/g,"").toUpperCase()}&timescale=3600&num=2000`),he()}),D(JSON.parse(await e.text())),se()}function ue(){const t=document.getElementById("loading-text");k=setInterval(()=>{t.innerText.length>9?t.innerText="Loading":t.innerText+="."},1e3)}function he(){clearInterval(k);const t=document.getElementById("loading-text");t.innerText="Ready!"}

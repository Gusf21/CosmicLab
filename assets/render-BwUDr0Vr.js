import"./style-BD-upOib.js";import{P as G,S as F,C as R,W as U,B,b as I,c as $,d as V,A as k,O as W,V as _,e as q,T as N,M as H,f as J}from"./OrbitControls-CiCO4lTP.js";function Q(t,e){return t+Math.floor(Math.random()*(e-t+1))}const v=149597870700,z=20;let g,y,M,w,P,A,D={},S=[],C=0,b=!0;function K(){X()}function X(){const t=window.innerWidth*.8/window.innerHeight;g=new G(60,t,.1,5e3),g.position.z=50,M=new F,M.background=new R(0),Y(),w=new U({antialias:!0}),w.setPixelRatio(window.devicePixelRatio),w.setSize(window.innerWidth*.8,window.innerHeight),w.setAnimationLoop(te),document.body.appendChild(w.domElement),window.addEventListener("resize",ee),Z(g)}function Y(){const t=new B,e=1e4,s=new Float32Array(e*3),o=new Float32Array(e),n=3e3,i=4e3;for(let a=0;a<e;a++){let m,h,r;m=Math.cbrt(Math.random()*(i**3-n**3)+n**3),h=Math.random()*Math.PI*2,r=Math.acos(2*Math.random()-1);let x=m*Math.sin(r)*Math.cos(h),c=m*Math.sin(r)*Math.sin(h),p=m*Math.cos(r);s[a*3]=x,s[a*3+1]=c,s[a*3+2]=p,o[a]=1.5+Math.random()}t.setAttribute("position",new I(s,3)),t.setAttribute("size",new I(o,1));const d=new $({uniforms:{time:{value:0}},vertexShader:`
        attribute float size;
        uniform float time;
        varying float vOpacity;
        
        void main() {
            vOpacity = 0.6 + 0.4 * sin(time + size * 10.0);
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            gl_PointSize = size * (300.0 / -mvPosition.z);
            gl_Position = projectionMatrix * mvPosition;
        }
    `,fragmentShader:`
        varying float vOpacity;
        void main() {
            gl_FragColor = vec4(1.0, 1.0, 1.0, vOpacity);
        }
    `,transparent:!0});P=new V(t,d),M.add(P),A=new k(1e3),M.add(A)}function Z(t){y=new W(t,w.domElement),y.target=new _(0,0,0),y.minDistance=.01,y.maxDistance=2e3,y.zoomSpeed=2,y.rotateSpeed=.3,y.enablePan=!1}function ee(){const t=window.innerWidth*.8/window.innerHeight;g.aspect=t,g.updateProjectionMatrix(),w.setSize(window.innerWidth*.8,window.innerHeight)}function T(t,e,s,o,n,i){const d=["Volcanic","Oceanic","Tropical","Gas Giant","Venusian","Ice","Swamp"],a=d[Math.floor(Math.random()*d.length)],m=Q(1,10),h=new q(.2*o,32,32);let r;i==null?r=new N().load(`../images/Textures/${a}/${a}-EQUIRECTANGULAR-${m}-1024x512.png`):(console.log(i),r=new N().load(`../images/Textures/Default/${i}.png`));const x=new H({map:r}),c=new J(h,x);c.position.set(t*z,s*z,e*z),document.getElementById(n).querySelector("i").addEventListener("click",()=>{g.position.set(c.position.x,c.position.y,c.position.z>0?c.position.z+10:c.position.z-10),y.target=c.position}),D[n]=c,M.add(c)}function te(){y.update(),P.material.uniforms.time.value=performance.now()*.002,ie()}function ie(){w.render(M,g)}function se(){setInterval(ne,1e3/24)}function L(t){S=S.concat(t)}window.ToggleSim=t=>{b=!b;let e=t.querySelector("i");b?(e.classList.remove("fa-pause"),e.classList.add("fa-play")):(e.classList.remove("fa-play"),e.classList.add("fa-pause"))};window.ToggleAxes=()=>{A.visible=!A.visible};function ne(){if(!b){let t=S[C];for(let e=0;e<t.length;e++)D[t[e].objectId].position.set(t[e].xPos*z/v,t[e].zPos*z/v,t[e].yPos*z/v);C++}C+1e3==S.length&&oe()}async function oe(){let t=await fetch(`https://localhost:7168/api/Data/GetFrames?sessionId=${O("sessionId").replace(/['"]+/g,"").toUpperCase()}&timescale=3600&num=2000`);L(JSON.parse(await t.text()))}function O(t){let e=t+"=",o=decodeURIComponent(document.cookie).split(";");for(let n=0;n<o.length;n++){let i=o[n];for(;i.charAt(0)==" ";)i=i.substring(1);if(i.indexOf(e)==0)return i.substring(e.length,i.length)}return""}const l=[{id:1,name:"The Sun",type:"star",mass:1,radius:1,satellites:[{object:{id:2,name:"Mercury",type:"planet",mass:.055,radius:.382},orbit:{smAxis:.387098,eccentricity:.20563,inclination:7.005,longOfAscNode:48.331,argOfPeri:29.124}},{object:{id:3,name:"Venus",type:"planet",mass:.815,radius:.95},orbit:{smAxis:.723332,eccentricity:.006772,inclination:3.395,longOfAscNode:76.68,argOfPeri:54.884}},{object:{id:4,name:"Earth",type:"planet",mass:1,radius:1},orbit:{smAxis:1,eccentricity:.0167086,inclination:.005,longOfAscNode:174.873,argOfPeri:288.064}},{object:{id:5,name:"Mars",type:"planet",mass:.107,radius:.532},orbit:{smAxis:1.52368055,eccentricity:.0934,inclination:1.85,longOfAscNode:49.57854,argOfPeri:286.5}},{object:{id:6,name:"Jupiter",type:"planet",mass:317.8,radius:11},orbit:{smAxis:5.2038,eccentricity:.0489,inclination:1.303,longOfAscNode:100.464,argOfPeri:273.867}},{object:{id:7,name:"Saturn",type:"planet",mass:95.159,radius:9},orbit:{smAxis:9.5826,eccentricity:.0565,inclination:2.485,longOfAscNode:113.665,argOfPeri:339.392}},{object:{id:8,name:"Uranus",type:"planet",mass:14.536,radius:4},orbit:{smAxis:19.19126,eccentricity:.04717,inclination:.773,longOfAscNode:74.006,argOfPeri:96.998857}},{object:{id:9,name:"Neptune",type:"planet",mass:17.147,radius:3.85},orbit:{smAxis:30.07,eccentricity:.008678,inclination:1.77,longOfAscNode:131.783,argOfPeri:273.187}}]}];let j=[];const ae=667408e-16,f=149597870700,ce=1.9884*10**30,le=5.972*10**24;class u{constructor(e,s,o){this.x=e,this.y=s,this.z=o}rotate(e,s){let o=Math.cos(s),n=Math.sin(s),i=1-o,d=this.x*o+this.x*e.x*e.x*i+this.y*e.x*e.y*i-this.y*e.z*n+this.z*e.y*n+this.z*e.x*e.z*i,a=this.x*e.z*n+this.x*e.x*e.y*i+this.y*o+this.y*e.y*e.y*i+-1*this.z*e.x*n+this.z*e.y*e.z*i,m=-1*this.x*e.y*n+this.x*e.x*e.z*i+this.y*e.x*n+this.y*e.y*e.z*i+this.z*o+this.z*e.z*e.z*i;this.x=d,this.y=a,this.z=m}multiply(e){this.x*=e,this.y*=e,this.z*=e}}document.addEventListener("DOMContentLoaded",()=>{O("sessionId"),K(),re()});window.addEventListener("beforeunload",()=>{fetch(`https://localhost:7168/api/Data/DeleteSimulation?sessionId=${O("sessionId").replace(/['"]+/g,"").toUpperCase()}`,{method:"POST",headers:{"Content-Type":"application/json"}})});function re(){const t=l.length;for(let e=0;e<t;e++){let s={CelestialObject:{id:l[e].id,name:l[e].name,type:l[e].type,mass:l[e].mass,radius:l[e].radius},telemetry:{position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0}}};const o=l[e].satellites.length;E(l[e]),T(s.telemetry.position.x/f,s.telemetry.position.y/f,s.telemetry.position.z/f,s.CelestialObject.radius*10,s.CelestialObject.id,s.CelestialObject.name),j.push(s);for(let n=0;n<o;n++){let i={CelestialObject:{id:l[e].satellites[n].object.id,name:l[e].satellites[n].object.name,type:l[e].satellites[n].object.type,mass:l[e].satellites[n].object.mass,radius:l[e].satellites[n].object.radius},telemetry:{position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0}}};me(s,i,l[e].satellites[n].orbit),E(l[e].satellites[n].object),T(i.telemetry.position.x/f,i.telemetry.position.y/f,i.telemetry.position.z/f,i.CelestialObject.radius,i.CelestialObject.id,i.CelestialObject.name),j.push(i)}}pe()}function E(t){const e=document.getElementById("card-container"),o=document.getElementById("info-card-template").content.cloneNode(!0);o.querySelector("span").innerText=t.name,o.querySelector("div").id=t.id,e.appendChild(o)}function de(t,e,s){let o=e-t*e;return Math.sqrt(ae*s*(2/o-1/e))}function me(t,e,s){const o=(s.smAxis-s.eccentricity*s.smAxis)*f,n=new u(o,0,0),i=new u(t.telemetry.position.x,t.telemetry.position.y,t.telemetry.position.z),d=s.longOfAscNode*Math.PI/180,a=s.inclination*Math.PI/180,m=s.argOfPeri*Math.PI/180,h=Math.cos(a),r=Math.sin(a),x=Math.cos(d),c=Math.sin(d);n.rotate(new u(0,0,1),d),n.rotate(new u(c,-1*x,0),a),n.rotate(new u(-1*r*x,-1*r*c,h),m),e.telemetry.position.x=i.x+n.x,e.telemetry.position.y=i.y+n.y,e.telemetry.position.z=i.z+n.z;let p=new u(0,1,0);p.rotate(new u(0,0,1),d),p.rotate(new u(-1*r*x,-1*r*c,h),m),p.multiply(de(s.eccentricity,s.smAxis*f,t.CelestialObject.mass*(t.CelestialObject.type=="planet"?le:ce))),e.telemetry.velocity.x=p.x,e.telemetry.velocity.y=p.y,e.telemetry.velocity.z=p.z}async function pe(){let t={};t.Objects=j,t.SessionId=O("sessionId").replace(/['"]+/g,"").toUpperCase(),t.Timescale=3600;let e;await fetch("https://localhost:7168/api/Data/StartSimulation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async()=>{e=await fetch(`https://localhost:7168/api/Data/GetFrames?sessionId=${O("sessionId").replace(/['"]+/g,"").toUpperCase()}&timescale=3600&num=2000`)}),L(JSON.parse(await e.text())),se()}
